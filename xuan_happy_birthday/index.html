<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生日祝福</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            transition: background 1.5s ease;
            background: linear-gradient(135deg, 
                rgba(255, 209, 220, 0.9) 0%, 
                rgba(181, 234, 215, 0.9) 25%, 
                rgba(174, 214, 241, 0.9) 50%, 
                rgba(209, 196, 233, 0.9) 75%, 
                rgba(255, 209, 220, 0.9) 100%);
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 页面通用过渡效果 */
        .page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease-in-out;
            opacity: 0;
            z-index: 10;
            pointer-events: none;
        }
        
        .page.active {
            opacity: 1;
            pointer-events: all;
        }

        /* 背景图容器 - 用于初始页面和视频页面 */
        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('images/xinghui1.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: -2;
            opacity: 0.8;
        }

        /* 祝福页面背景容器 - 添加两张图片并实现淡入淡出效果 */
        .blessing-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }
        
        .blessing-bg-1 {
            background-image: url('images/lu1.jpg'); /* 第一张祝福背景图 */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .blessing-bg-2 {
            background-image: url('images/lu2.jpg'); /* 第二张祝福背景图 */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .blessing-background.active {
            opacity: 0.8;
        }

        /* 背景遮罩，让文字更清晰 */
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            z-index: -1;
        }
        
        /* 初始页面样式 */
        #birthday-page {
            padding: 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        
        h1 {
            font-family: 'Pacifico', cursive;
            color: #FF6B8B;
            font-size: 4.5rem;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0px #FFD166, 
                         6px 6px 0px rgba(0,0,0,0.1);
            letter-spacing: 2px;
            background: linear-gradient(45deg, #FF6B8B, #FF9E6D);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }
        
        .subtitle {
            font-family: 'Dancing Script', cursive;
            color: #5AA9E6;
            font-size: 2.5rem;
            margin-bottom: 40px;
            text-shadow: 2px 2px 0px #FFD166;
            letter-spacing: 1px;
        }
        
        p {
            color: #7F7F7F;
            font-size: 1.5rem;
            margin-bottom: 40px;
            text-align: center;
            max-width: 80%;
            line-height: 1.8;
            font-family: 'Dancing Script', cursive;
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* 蛋糕GIF按钮样式 */
        #cake-button, #note-button {
            width: 150px; /* 从180px缩小到150px */
            height: 150px; /* 从180px缩小到150px */
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.5s ease;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #cake-button:hover, #note-button:hover {
            transform: scale(1.1) rotate(5deg);
            filter: drop-shadow(0 15px 25px rgba(0,0,0,0.3));
        }
        
        #cake-button:active, #note-button:active {
            transform: scale(0.95);
        }
        
        .cake-gif, .note-gif {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
        }
        
        .click-hint {
            margin-top: 20px;
            color: #5AA9E6;
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            text-shadow: 1px 1px 0px white;
        }
        
        /* 视频容器样式 */
        #video-container {
            background: rgba(0,0,0,0.9);
            flex-direction: column;
        }
        
        /* 视频页面背景图 */
        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('images/xinghui2.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.3;
            z-index: -1;
        }
        
        .video-wrapper {
            width: 700px;
            height: 1010px;
            position: relative;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(255,255,255,0.2);
            background: #000;
        }
        
        #birthday-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background-color: #000;
        }
        
        .video-tip {
            color: white;
            margin-top: 20px;
            font-size: 1.2rem;
            text-align: center;
            max-width: 90%;
        }
        
        /* 跳过视频按钮 */
        #skip-video-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            z-index: 25;
            font-family: 'Dancing Script', cursive;
            font-size: 1.3rem;
        }
        
        #skip-video-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        /* 装饰元素 */
        .decoration {
            position: absolute;
            z-index: 1;
        }
        
        .balloon {
            width: 60px;
            height: 80px;
            border-radius: 50%;
            position: absolute;
            animation: float 8s ease-in-out infinite;
        }
        
        .balloon:nth-child(1) { background: #FF6B8B; top: 10%; left: 10%; animation-delay: 0s; }
        .balloon:nth-child(2) { background: #5AA9E6; top: 15%; right: 15%; animation-delay: 1s; }
        .balloon:nth-child(3) { background: #FFD166; bottom: 20%; left: 20%; animation-delay: 2s; }
        .balloon:nth-child(4) { background: #06D6A0; bottom: 15%; right: 10%; animation-delay: 3s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            opacity: 0.7;
            animation: confettiFall 5s linear infinite;
        }
        
        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        /* 飘动的GIF元素 - 提高z-index确保置顶 */
        .floating-gif {
            position: absolute;
            z-index: 100;
            pointer-events: none;
            animation: floating 15s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, -15px) rotate(5deg); }
            50% { transform: translate(-15px, 10px) rotate(-3deg); }
            75% { transform: translate(10px, -5px) rotate(2deg); }
        }
        
        /* 祝福语标签样式 */
        .blessing-tag {
            position: absolute;
            padding: 12px 24px;
            background: rgba(255,255,255,0.9);
            border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-size: 1.2rem;
            color: #333;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
            transition: all 2s ease-in-out;
            z-index: 5;
        }
        
        /* 信封样式 */
        #envelope-page {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .envelope-container {
            width: 500px;
            height: 350px;
            position: relative;
            perspective: 1000px;
            cursor: pointer;
        }
        
        .envelope {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1.5s ease;
        }
        
        .envelope.open {
            transform: rotateX(180deg);
        }
        
        .envelope-front, .envelope-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            text-align: center;
            overflow: hidden;
        }
        
        .envelope-front {
            background: linear-gradient(135deg, #FF9E6D, #FF6B8B);
            transform: rotateX(0deg);
            z-index: 2;
            border: 8px double rgba(255, 255, 255, 0.7);
        }
        
        .envelope-back {
            background: linear-gradient(135deg, #A8D8FF, #FFB6C1);
            transform: rotateX(180deg);
            z-index: 1;
            border: 8px double rgba(255, 255, 255, 0.7);
        }
        
        .envelope-flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(135deg, #FF9E6D, #FF6B8B);
            border-radius: 10px 10px 0 0;
            transform-origin: top;
            transition: transform 1s ease;
            z-index: 3;
            border-bottom: 8px double rgba(255, 255, 255, 0.7);
        }
        
        .envelope.open .envelope-flap {
            transform: rotateX(180deg);
        }
        
        .envelope-heart {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: white;
            transform: rotate(45deg);
            opacity: 0.8;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }
        
        .envelope-heart:before,
        .envelope-heart:after {
            content: '';
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            position: absolute;
        }
        
        .envelope-heart:before {
            top: -20px;
            left: 0;
        }
        
        .envelope-heart:after {
            top: 0;
            left: -20px;
        }
        
        .envelope-title {
            font-family: 'Pacifico', cursive;
            font-size: 2.5rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 15px;
        }
        
        .envelope-subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        /* 信封装饰元素 */
        .envelope-decoration {
            position: absolute;
            z-index: 4;
            pointer-events: none;
        }
        
        .decoration-star {
            width: 20px;
            height: 20px;
            background: #FFD166;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: twinkle 3s infinite;
        }
        
        .decoration-dot {
            width: 10px;
            height: 10px;
            background: #06D6A0;
            border-radius: 50%;
            animation: bounce 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* 点击信封的GIF样式 */
        .envelope-click-gif {
            width: 80px;
            height: 80px;
            margin-top: 20px;
            cursor: pointer;
            border-radius: 50%;
            transition: transform 0.3s ease;
            z-index: 5;
        }
        
        .envelope-click-gif:hover {
            transform: scale(1.1);
        }
        
        .card-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .card-title {
            font-family: 'Pacifico', cursive;
            font-size: 2.2rem;
            color: #FF6B8B;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
            margin-bottom: 15px;
            line-height: 1.2;
        }
        
        .card-subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 1.6rem;
            color: #5AA9E6;
            text-shadow: 1px 1px 3px rgba(255,255,255,0.8);
            margin-bottom: 25px;
        }
        
        .card-blessings {
            font-family: 'Dancing Script', cursive;
            font-size: 1.3rem;
            color: #666;
            line-height: 1.8;
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            width: 90%;
            max-height: 70%;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .blessing-line {
            margin: 8px 0;
            padding: 3px 0;
            text-align: center;
            width: 100%;
        }
        
        /* 最终祝福样式 */
        #final-blessings {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 10;
        }
        
        .final-blessing {
            position: absolute;
            padding: 15px 25px;
            background: rgba(255,255,255,0.95);
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            font-size: 1.3rem;
            color: #ff6b6b;
            font-weight: bold;
            opacity: 0;
            transition: opacity 1s ease;
            font-family: 'Pacifico', cursive;
        }
        
        .final-blessing.fade-in {
            opacity: 1;
        }
        
        .final-blessing.fade-out {
            opacity: 0;
        }
        
        /* 便签墙页面样式 */
        #note-wall-page {
            background: #f5f5f5;
            overflow: hidden;
        }
        
        .note-wall-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        #note-wall-board {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-image: linear-gradient(0deg, #eee 1px, transparent 0),
                linear-gradient(90deg, #eee 1px, transparent 0);
            background-size: 30px 30px;
        }
        
        .note-card {
            position: absolute;
            width: 220px;
            border-radius: 12px;
            box-shadow: 0 16px 35px rgba(0, 0, 0, 0.2);
            background: #fff;
            border: 1px solid rgba(0, 0, 0, 0.08);
            overflow: hidden;
            opacity: 0;
            transform-origin: center;
            transition: transform 0.35s ease, opacity 0.35s ease, left 0.35s ease,
                top 0.35s ease, width 0.35s ease, height 0.35s ease,
                border-radius 0.35s ease;
        }
        
        .note-card.dragging {
            transition: none;
            box-shadow: 0 22px 45px rgba(0, 0, 0, 0.35);
        }
        
        .note-card.maximized {
            position: fixed;
            inset: 0;
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            border-radius: 0;
            box-shadow: 0 28px 60px rgba(0, 0, 0, 0.4);
        }
        
        .note-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.7);
            cursor: grab;
            user-select: none;
            touch-action: pan-y;
        }
        
        .note-card-header.dragging {
            cursor: grabbing;
        }
        
        .note-window-controls {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .note-window-controls .control {
            position: relative;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, 0.08);
            background: #ccc;
            cursor: pointer;
            outline: none;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .note-window-controls .control.close {
            background: #ff5f57;
            border-color: #e0443e;
        }
        
        .note-window-controls .control.minimize {
            background: #febb2e;
            border-color: #dea123;
        }
        
        .note-window-controls .control.maximize {
            background: #28c840;
            border-color: #1aab2c;
        }
        
        .note-window-controls .control::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .note-card-header:hover .note-window-controls .control::after {
            opacity: 0.8;
        }
        
        .note-window-controls .control.close::after {
            content: '×';
            width: auto;
            height: auto;
            background: none;
            font-size: 10px;
            line-height: 1;
            font-weight: 700;
            color: rgba(0, 0, 0, 0.7);
        }
        
        .note-window-controls .control.minimize::after {
            width: 6px;
            height: 2px;
            background: rgba(0, 0, 0, 0.6);
        }
        
        .note-window-controls .control.maximize::after {
            width: 6px;
            height: 6px;
            background: linear-gradient(
                45deg,
                rgba(0, 0, 0, 0.6) 0%,
                rgba(0, 0, 0, 0.6) 45%,
                transparent 45%,
                transparent 55%,
                rgba(0, 0, 0, 0.6) 55%,
                rgba(0, 0, 0, 0.6) 100%
            );
        }
        
        .note-card-title {
            font-size: 13px;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.55);
            padding-left: 10px;
            flex: 1;
        }
        
        .note-card-body {
            padding: 16px;
            font-size: 16px;
            line-height: 1.4;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.72);
            word-break: break-word;
            overflow-wrap: anywhere;
            white-space: normal;
        }
        
        .note-card.maximized {
            display: flex;
            flex-direction: column;
        }
        
        .note-card.maximized .note-card-title {
            display: none;
        }
        
        .note-card.maximized .note-card-body {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            text-align: center;
            padding: clamp(32px, min(10vw, 10vh), 128px);
            padding-top: clamp(72px, min(14vw, 14vh), 192px);
            font-size: clamp(48px, min(18vw, 18vh), 200px);
            line-height: 1.05;
        }
        
        @media (max-width: 768px) {
            .note-card {
                width: 180px;
                border-radius: 10px;
            }
        
            .note-card-body {
                padding: 14px;
                font-size: 14px;
            }
        
            .note-card-title {
                font-size: 12px;
            }
        }
        
        /* 第三个页面右下角按钮样式 */
        .envelope-bottom-button {
            position: absolute;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .envelope-bottom-button .click-hint {
            margin-top: 10px;
            color: #5AA9E6;
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            text-shadow: 1px 1px 0px white;
        }
    </style>
</head>
<body>
    <!-- 背景图 - 用于初始页面和视频页面 -->
    <div class="background-image"></div>
    
    <!-- 祝福页面背景 - 两张图片淡入淡出切换 -->
    <div class="blessing-background blessing-bg-1"></div>
    <div class="blessing-background blessing-bg-2"></div>
    
    <!-- 背景遮罩，让文字更清晰 -->
    <div class="background-overlay"></div>
    
    <!-- 装饰元素 -->
    <div class="decoration balloon"></div>
    <div class="decoration balloon"></div>
    <div class="decoration balloon"></div>
    <div class="decoration balloon"></div>
    
    <!-- 飘动的WEBP元素 - 置顶显示 -->
    <div class="floating-gif" style="top: 10%; left: 5%; width: 150px; height: 150px;">
        <img src="images/lu3.WEBP" alt="飘动元素" style="width: 100%; height: 100%;">
    </div>
    <div class="floating-gif" style="top: 20%; right: 8%; width: 140px; height: 140px; animation-delay: 2s;">
        <img src="images/xinghui3.WEBP" alt="飘动元素" style="width: 100%; height: 100%;">
    </div>
    <div class="floating-gif" style="bottom: 15%; left: 10%; width: 150px; height: 150px; animation-delay: 4s;">
        <img src="images/lu4.WEBP" alt="飘动元素" style="width: 100%; height: 100%;">
    </div>
    <div class="floating-gif" style="bottom: 25%; right: 5%; width: 160px; height: 160px; animation-delay: 6s;">
        <img src="images/xinghui4.webp" alt="飘动元素" style="width: 100%; height: 100%;">
    </div>
    
    <!-- 初始生日祝福页面 -->
    <div id="birthday-page" class="page active">
        <h1>Happy Birthday!</h1>
        <div class="subtitle">生日快乐！</div>
        <p>亲爱的牢宣，今天是一个属于你的很特别的日子<br>愿所有的快乐、所有的幸福、所有的温馨、所有的好运都围绕在你身边</p>
        
        <!-- 蛋糕GIF按钮 -->
        <button id="cake-button">
            <img src="images/cake.gif" alt="生日蛋糕" class="cake-gif">
        </button>
        
        <div class="click-hint">点我点我！！！</div>
    </div>
    
    <!-- 视频播放容器 -->
    <div id="video-container" class="page">
        <!-- 视频页面背景图 -->
        <div class="video-background"></div>
        
        <button id="skip-video-btn">跳过视频</button>
        <div class="video-wrapper">
            <video id="birthday-video">
                <source src="videos/hui2.mp4" type="video/mp4">
                您的浏览器不支持视频播放。
            </video>
        </div>
    </div>
    
    <!-- 信封页面 -->
    <div id="envelope-page" class="page">
        <div class="envelope-container">
            <div class="envelope">
                <!-- 信封装饰元素 -->
                <div class="envelope-decoration decoration-star" style="top: 15px; left: 15px;"></div>
                <div class="envelope-decoration decoration-dot" style="top: 25px; left: 45px;"></div>
                <div class="envelope-decoration decoration-star" style="bottom: 15px; right: 15px; animation-delay: 1s;"></div>
                <div class="envelope-decoration decoration-dot" style="bottom: 25px; right: 45px; animation-delay: 1s;"></div>
                
                <div class="envelope-flap"></div>
                <div class="envelope-front">
                    <div class="envelope-heart"></div>
                    <div class="envelope-title">Happy Birthday!</div>
                    <div class="envelope-subtitle">生日快乐！</div>
                    <!-- 替换为GIF的点击提示 -->
                    <img src="images/xinghui3.jpg" alt="点击打开信封" class="envelope-click-gif">
                </div>
                <div class="envelope-back">
                    <div class="card-content">
                        <div class="card-title">Happy Birthday!</div>
                        <div class="card-subtitle">生日快乐！</div>
                        <div class="card-blessings">
                            <div class="blessing-line">愿你前程似锦</div>
                            <div class="blessing-line">考研顺利</div>
                            <div class="blessing-line">梦想成真！</div>
                            <div class="blessing-line">友谊长存！</div>
                            <div class="blessing-line">学业有成！</div>
                            <div class="blessing-line">健康平安！</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 第三个页面右下角按钮 -->
        <div class="envelope-bottom-button">
            <button id="note-button">
                <img src="images/xinghui5.jpg" alt="最后再点我" class="note-gif">
            </button>
            <div class="click-hint">最后再点我</div>
        </div>
    </div>
    
    <!-- 便签墙页面 -->
    <div id="note-wall-page" class="page">
        <div class="note-wall-container">
            <div id="note-wall-board"></div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const pages = document.querySelectorAll('.page');
            const birthdayPage = document.getElementById('birthday-page');
            const videoContainer = document.getElementById('video-container');
            const birthdayVideo = document.getElementById('birthday-video');
            const cakeButton = document.getElementById('cake-button');
            const skipVideoBtn = document.getElementById('skip-video-btn');
            const envelopePage = document.getElementById('envelope-page');
            const envelope = document.querySelector('.envelope');
            const envelopeClickGif = document.querySelector('.envelope-click-gif');
            const noteButton = document.getElementById('note-button');
            const noteWallPage = document.getElementById('note-wall-page');
            const backgroundImage = document.querySelector('.background-image');
            const blessingBackgrounds = document.querySelectorAll('.blessing-background');
            
            // 页面切换函数
            function switchPage(fromPage, toPage) {
                fromPage.classList.remove('active');
                setTimeout(() => {
                    toPage.classList.add('active');
                }, 1000);
                
                // 如果切换到便签墙页面，隐藏飘动WEBP元素和背景切换
                if (toPage.id === 'note-wall-page') {
                    document.querySelectorAll('.floating-gif').forEach(gif => {
                        gif.style.display = 'none';
                    });
                    document.querySelector('.background-image').style.display = 'none';
                    document.querySelectorAll('.blessing-background').forEach(bg => {
                        bg.style.display = 'none';
                    });
                    document.querySelector('.background-overlay').style.display = 'none';
                    document.querySelectorAll('.balloon').forEach(balloon => {
                        balloon.style.display = 'none';
                    });
                    if (bgInterval) {
                        clearInterval(bgInterval);
                    }
                }
            }
            
            // 祝福页面背景切换变量
            let currentBgIndex = 0;
            let bgInterval;
            
            // 创建彩色纸屑
            function createConfetti() {
                const colors = ['#FF6B8B', '#5AA9E6', '#FFD166', '#06D6A0', '#9B5DE5'];
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'decoration confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 5 + 's';
                    confetti.style.animationDuration = (3 + Math.random() * 7) + 's';
                    document.body.appendChild(confetti);
                }
            }
            
            createConfetti();
            
            // 正确的祝福语数组
            const blessings = [
                "前程似锦！",
                "学业有成！", 
                "心想事成！",
                "一帆风顺！",
                "梦想成真！",
                "马到成功！",
                "步步高升！",
                "健康平安！",
                "笑口常开！",
                "幸福美满！",
                "好运连连！",
                "天天开心！",
                "青春永驻！",
                "万事如意！",
                "友谊长存！",
                "事业顺利！",
                "财源广进！",
                "考研顺利！",
                "金榜题名！"
            ];
            
            // 点击蛋糕按钮显示视频
            cakeButton.addEventListener('click', function() {
                switchPage(birthdayPage, videoContainer);
                
                setTimeout(() => {
                    const playPromise = birthdayVideo.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log("视频播放失败:", error);
                            setTimeout(videoEnded, 1000);
                        });
                    }
                }, 1000);
            });
            
            // 跳过视频按钮
            skipVideoBtn.addEventListener('click', function() {
                birthdayVideo.pause();
                videoEnded();
            });
            
            // 视频播放结束后的处理
            birthdayVideo.addEventListener('ended', videoEnded);
            
            // 视频播放结束后的通用处理函数
            function videoEnded() {
                switchPage(videoContainer, envelopePage);
                
                // 隐藏初始背景，显示祝福背景
                backgroundImage.style.display = 'none';
                startBlessingBackgroundAnimation();
            }
            
            // 开始祝福页面背景切换动画
            function startBlessingBackgroundAnimation() {
                // 显示第一张背景图
                blessingBackgrounds[0].classList.add('active');
                
                // 设置定时切换背景
                bgInterval = setInterval(() => {
                    // 隐藏当前背景
                    blessingBackgrounds[currentBgIndex].classList.remove('active');
                    
                    // 切换到下一张背景
                    currentBgIndex = (currentBgIndex + 1) % blessingBackgrounds.length;
                    
                    // 显示新背景
                    blessingBackgrounds[currentBgIndex].classList.add('active');
                }, 5000); // 每5秒切换一次
            }
            
            // 点击信封或GIF打开
            envelope.addEventListener('click', function() {
                envelope.classList.add('open');
                
                // 信封打开后开始祝福动画
                setTimeout(() => {
                    startBlessingAnimation();
                }, 1500);
            });
            
            // 点击便签墙按钮
            noteButton.addEventListener('click', function() {
                switchPage(envelopePage, noteWallPage);
                initializeNoteWall();
            });
            
            // 开始祝福标签动画
            function startBlessingAnimation() {
                // 创建祝福标签并设置初始位置在窗口外
                const tags = [];
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                
                const starBlessing = "生日快乐！";
                
                for (let i = 0; i < 5; i++) {
                    const tag = document.createElement('div');
                    tag.className = 'blessing-tag';
                    tag.textContent = starBlessing;
                    
                    const side = Math.floor(Math.random() * 4);
                    let startX, startY;
                    
                    switch(side) {
                        case 0: startX = Math.random() * window.innerWidth; startY = -100; break;
                        case 1: startX = window.innerWidth + 100; startY = Math.random() * window.innerHeight; break;
                        case 2: startX = Math.random() * window.innerWidth; startY = window.innerHeight + 100; break;
                        case 3: startX = -100; startY = Math.random() * window.innerHeight; break;
                    }
                    
                    tag.style.left = `${startX}px`;
                    tag.style.top = `${startY}px`;
                    tag.style.opacity = '1';
                    
                    tag.style.background = 'linear-gradient(135deg, #A8D8FF, #FFB6C1)';
                    tag.style.color = '#666';
                    tag.style.border = '2px solid rgba(255, 255, 255, 0.7)';
                    tag.style.boxShadow = '0 0 15px rgba(168, 216, 255, 0.7)';
                    tag.style.fontFamily = 'Pacifico, cursive';
                    tag.style.fontSize = '1.3rem';
                    
                    document.body.appendChild(tag);
                    tags.push(tag);
                    
                    setTimeout(() => {
                        const targetX = centerX + (Math.random() - 0.5) * 100;
                        const targetY = centerY + (Math.random() - 0.5) * 100;
                        
                        tag.style.left = `${targetX}px`;
                        tag.style.top = `${targetY}px`;
                        tag.style.transform = 'translate(-50%, -50%)';
                    }, 100 + i * 200);
                }
                
                setTimeout(() => {
                    // 移除所有标签
                    tags.forEach(tag => {
                        tag.style.opacity = '0';
                        setTimeout(() => {
                            if (tag.parentNode) tag.remove();
                        }, 1000);
                    });
                }, 2000);
            }
            
            // 便签墙功能
            function initializeNoteWall() {
                const board = document.getElementById('note-wall-board');
                const messages = [
                    '保持好心情',
                    '多喝水哦',
                    '今天辛苦啦',
                    '早点休息',
                    '记得吃水果',
                    '加油，你可以的',
                    '祝你顺利',
                    '保持微笑呀',
                    '愿所有烦恼都消失',
                    '期待下一次见面',
                    '梦想总会实现',
                    '天气冷了，多穿衣服',
                    '记得给自己放松',
                    '每天都要元气满满',
                    '今天也要好好爱自己',
                    '适当休息一下'
                ];
            
                const colors = [
                    '#ffe0e3',
                    '#c7f0ff',
                    '#ffd8a8',
                    '#d9f2d9',
                    '#e5d7ff',
                    '#f9f7d9',
                    '#d2f0f8',
                    '#ffd4f5'
                ];
            
                const cardStates = new WeakMap();
                const MAXIMIZED_LAYER = 1000000;
                let activeMaximizedCard = null;
                const pointerMediaQuery = window.matchMedia('(pointer: coarse)');
                let isMobile = pointerMediaQuery.matches || window.innerWidth <= 768;
                let maxCards = isMobile ? 120 : 180;
                const initialCardCount = isMobile ? 18 : 30;
                let spawnInterval = isMobile ? 700 : 400;
                let zIndexCursor = 200;
                let spawnTimer = null;
            
                document.body.classList.toggle('is-mobile', isMobile);
            
                function randomFrom(array) {
                    return array[Math.floor(Math.random() * array.length)];
                }
            
                function clamp(value, min, max) {
                    return Math.min(Math.max(value, min), max);
                }
            
                function applyTransform(card, state) {
                    const scale = state.scale ?? 1;
                    const angle = state.angle ?? 0;
                    card.style.transform = `scale(${scale}) rotate(${angle}deg)`;
                }
            
                function bringToFront(card) {
                    if (card === activeMaximizedCard) {
                        card.style.zIndex = MAXIMIZED_LAYER;
                        return;
                    }
            
                    zIndexCursor += 1;
                    if (activeMaximizedCard && zIndexCursor >= MAXIMIZED_LAYER) {
                        zIndexCursor = MAXIMIZED_LAYER - 1;
                    }
            
                    card.style.zIndex = zIndexCursor;
                }
            
                function updateBodyMaximizedState() {
                    document.body.classList.toggle(
                        'has-maximized-card',
                        Boolean(activeMaximizedCard)
                    );
                }
            
                function scheduleNextSpawn() {
                    clearTimeout(spawnTimer);
                    spawnTimer = setTimeout(() => {
                        if (!document.hidden) {
                            createCard();
                        }
                        scheduleNextSpawn();
                    }, spawnInterval);
                }
            
                function syncMobileMode() {
                    const nextIsMobile = pointerMediaQuery.matches || window.innerWidth <= 768;
                    if (nextIsMobile === isMobile) return;
            
                    isMobile = nextIsMobile;
                    maxCards = isMobile ? 120 : 180;
                    spawnInterval = isMobile ? 700 : 400;
                    document.body.classList.toggle('is-mobile', isMobile);
                    scheduleNextSpawn();
                }
            
                function handleBoardClick(event) {
                    const control = event.target.closest('.control');
                    if (!control) return;
            
                    const card = control.closest('.note-card');
                    if (!card || !board.contains(card)) return;
            
                    event.preventDefault();
            
                    if (control.classList.contains('close')) {
                        closeCard(card);
                    } else if (control.classList.contains('minimize')) {
                        minimizeCard(card);
                    } else if (control.classList.contains('maximize')) {
                        toggleMaximize(card);
                    }
                }
            
                function handleBoardPointerDown(event) {
                    const card = event.target.closest('.note-card');
                    if (!card || !board.contains(card)) return;
            
                    const control = event.target.closest('.control');
                    const header = event.target.closest('.note-card-header');
                    const pointerType = event.pointerType || 'mouse';
                    const isPrimaryPointer = event.isPrimary !== false;
            
                    if (header && !control && pointerType !== 'touch' && isPrimaryPointer) {
                        startDrag(event, card);
                        return;
                    }
            
                    bringToFront(card);
                }
            
                function handleBoardDoubleClick(event) {
                    const header = event.target.closest('.note-card-header');
                    if (!header || event.target.closest('.control')) return;
            
                    const card = header.closest('.note-card');
                    if (!card || !board.contains(card)) return;
            
                    toggleMaximize(card);
                }
            
                board.addEventListener('click', handleBoardClick);
                board.addEventListener('pointerdown', handleBoardPointerDown);
                board.addEventListener('dblclick', handleBoardDoubleClick);
            
                function closeCard(card) {
                    const state = cardStates.get(card);
                    if (!state || state.closing) return;
                    if (card === activeMaximizedCard) {
                        activeMaximizedCard = null;
                        updateBodyMaximizedState();
                    }
                    state.closing = true;
                    state.scale = 0.1;
                    card.style.opacity = '0';
                    applyTransform(card, state);
            
                    const handleTransitionEnd = event => {
                        if (event.propertyName === 'opacity') {
                            card.removeEventListener('transitionend', handleTransitionEnd);
                            card.remove();
                        }
                    };
            
                    card.addEventListener('transitionend', handleTransitionEnd);
                }
            
                function minimizeCard(card) {
                    const state = cardStates.get(card);
                    if (!state || state.closing) return;
            
                    const runMinimize = () => {
                        state.closing = true;
                        bringToFront(card);
                        const bottom = Math.max(window.innerHeight - 24, 0);
                        const targetLeft = clamp(
                            state.left,
                            16,
                            Math.max(window.innerWidth - card.offsetWidth - 16, 16)
                        );
            
                        state.left = targetLeft;
                        state.top = bottom;
                        state.scale = 0.1;
                        state.angle = 0;
                        card.style.left = `${targetLeft}px`;
                        card.style.top = `${bottom}px`;
                        card.style.opacity = '0.35';
                        applyTransform(card, state);
            
                        const handleTransitionEnd = event => {
                            if (event.propertyName === 'transform') {
                                card.removeEventListener('transitionend', handleTransitionEnd);
                                card.remove();
                            }
                        };
            
                    card.addEventListener('transitionend', handleTransitionEnd);
                    };
            
                    if (state.maximized) {
                        restoreFromMaximize(card, state);
                        requestAnimationFrame(() => {
                            requestAnimationFrame(runMinimize);
                        });
                        return;
                    }
            
                    runMinimize();
                }
            
                function toggleMaximize(card) {
                    const state = cardStates.get(card);
                    if (!state || state.closing) return;
            
                    if (state.maximized) {
                        restoreFromMaximize(card, state);
                    } else {
                        maximizeCard(card, state);
                    }
                }
            
                function maximizeCard(card, state) {
                    if (activeMaximizedCard && activeMaximizedCard !== card) {
                        const activeState = cardStates.get(activeMaximizedCard);
                        if (activeState) {
                            restoreFromMaximize(activeMaximizedCard, activeState);
                        }
                    }
            
                    state.beforeMaximize = {
                        left: state.left,
                        top: state.top,
                        scale: state.scale ?? 1,
                        angle: state.angle ?? 0,
                        width: card.offsetWidth,
                        height: card.offsetHeight,
                        inlinePosition: card.style.position
                    };
            
                    card.classList.add('maximized');
                    card.style.position = 'fixed';
                    card.style.left = '0px';
                    card.style.top = '0px';
                    card.style.width = '100vw';
                    card.style.height = '100dvh';
                    card.style.borderRadius = '0';
            
                    state.left = 0;
                    state.top = 0;
                    state.scale = 1;
                    state.angle = 0;
                    applyTransform(card, state);
                    activeMaximizedCard = card;
                    bringToFront(card);
                    state.maximized = true;
                    updateBodyMaximizedState();
                }
            
                function restoreFromMaximize(card, state) {
                    const previous = state.beforeMaximize;
                    if (!previous) return;
            
                    card.classList.remove('maximized');
                    card.style.position = previous.inlinePosition || 'absolute';
                    card.style.left = `${previous.left}px`;
                    card.style.top = `${previous.top}px`;
                    card.style.width = `${previous.width}px`;
                    card.style.height = `${previous.height}px`;
                    card.style.borderRadius = '12px';
            
                    state.left = previous.left;
                    state.top = previous.top;
                    state.scale = previous.scale ?? 1;
                    state.angle = previous.angle ?? state.angle ?? 0;
                    applyTransform(card, state);
                    state.maximized = false;
                    if (activeMaximizedCard === card) {
                        activeMaximizedCard = null;
                        updateBodyMaximizedState();
                    }
                    bringToFront(card);
                    setTimeout(() => {
                        if (!state.maximized) {
                            card.style.width = '';
                            card.style.height = '';
                            card.style.borderRadius = '';
                            if (previous.inlinePosition) {
                                card.style.position = previous.inlinePosition;
                            } else {
                                card.style.position = '';
                            }
                            state.beforeMaximize = null;
                        }
                    }, 360);
                }
            
                function startDrag(event, card) {
                    const control = event.target.closest('.control');
                    if (control) return;
            
                    const state = cardStates.get(card);
                    if (!state || state.closing || state.maximized) return;
            
                    event.preventDefault();
                    bringToFront(card);
            
                    const header = card.querySelector('.note-card-header');
                    card.classList.add('dragging');
                    header.classList.add('dragging');
            
                    state.dragging = true;
                    state.dragOffsetX = event.clientX - state.left;
                    state.dragOffsetY = event.clientY - state.top;
            
                    let dragFrame = null;
                    let pendingLeft = state.left;
                    let pendingTop = state.top;
            
                    const commitDrag = () => {
                        dragFrame = null;
                        const maxLeft = Math.max(window.innerWidth - card.offsetWidth, 0);
                        const maxTop = Math.max(window.innerHeight - card.offsetHeight, 0);
                        state.left = clamp(pendingLeft, -card.offsetWidth * 0.4, maxLeft);
                        state.top = clamp(pendingTop, -card.offsetHeight * 0.4, maxTop);
                        card.style.left = `${state.left}px`;
                        card.style.top = `${state.top}px`;
                    };
            
                    const handlePointerMove = moveEvent => {
                        if (!state.dragging) return;
            
                        pendingLeft = moveEvent.clientX - state.dragOffsetX;
                        pendingTop = moveEvent.clientY - state.dragOffsetY;
                        if (dragFrame === null) {
                            dragFrame = requestAnimationFrame(commitDrag);
                        }
                    };
            
                    const handlePointerUp = () => {
                        state.dragging = false;
                        card.classList.remove('dragging');
                        header.classList.remove('dragging');
                        if (dragFrame !== null) {
                            cancelAnimationFrame(dragFrame);
                            commitDrag();
                        }
                        document.removeEventListener('pointermove', handlePointerMove);
                        document.removeEventListener('pointerup', handlePointerUp);
                    };
            
                    document.addEventListener('pointermove', handlePointerMove);
                    document.addEventListener('pointerup', handlePointerUp);
                }
            
                function createCard() {
                    const card = document.createElement('div');
                    card.className = 'note-card';
            
                    const color = randomFrom(colors);
                    const angleRange = isMobile ? 6 : 10;
                    const angle = (Math.random() - 0.5) * angleRange;
                    const entryScale = isMobile ? 0.8 : 0.65;
                    const cardWidth = isMobile ? 180 : 220;
                    const cardHeight = isMobile ? 130 : 140;
                    const horizontalMargin = isMobile ? 12 : 16;
                    const verticalMargin = isMobile ? 12 : 20;
                    const left = horizontalMargin + Math.random() * Math.max(window.innerWidth - cardWidth - horizontalMargin * 2, 0);
                    const top = verticalMargin + Math.random() * Math.max(window.innerHeight - cardHeight - verticalMargin * 2, 0);
            
                    card.style.background = color;
                    card.style.left = `${left}px`;
                    card.style.top = `${top}px`;
                    card.style.opacity = '0';
                    if (activeMaximizedCard && zIndexCursor >= MAXIMIZED_LAYER - 2) {
                        zIndexCursor = MAXIMIZED_LAYER - 2;
                    }
                    card.style.zIndex = ++zIndexCursor;
            
                    card.innerHTML = `
                        <div class="note-card-header">
                            <div class="note-window-controls">
                                <button class="control close" type="button" aria-label="关闭"></button>
                                <button class="control minimize" type="button" aria-label="最小化"></button>
                                <button class="control maximize" type="button" aria-label="最大化"></button>
                            </div>
                            <div class="note-card-title">温馨提示</div>
                        </div>
                        <div class="note-card-body">${randomFrom(messages)}</div>
                    `;
            
                    const state = {
                        angle,
                        scale: entryScale,
                        left,
                        top,
                        maximized: false,
                        closing: false
                    };
            
                    cardStates.set(card, state);
                    applyTransform(card, state);
                    board.appendChild(card);
            
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            state.scale = 1;
                            applyTransform(card, state);
                            card.style.opacity = '1';
                        });
                    });
            
                    if (board.children.length > maxCards) {
                        const oldest = board.firstElementChild;
                        if (oldest && oldest !== card) {
                            oldest.remove();
                        }
                    }
                }
            
                for (let i = 0; i < initialCardCount; i++) {
                    setTimeout(createCard, i * (isMobile ? 60 : 40));
                }
            
                scheduleNextSpawn();
            
                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden) {
                        scheduleNextSpawn();
                    }
                });
            
                if (typeof pointerMediaQuery.addEventListener === 'function') {
                    pointerMediaQuery.addEventListener('change', syncMobileMode);
                } else if (typeof pointerMediaQuery.addListener === 'function') {
                    pointerMediaQuery.addListener(syncMobileMode);
                }
            
                window.addEventListener('resize', syncMobileMode);
            }
        });
    </script>
</body>
</html>